# Maintainer: Cartesian Dev <your_email>

pkgname=cartesian-core
pkgver=0.1.0
pkgrel=1
pkgdesc="AI System Manager for Cartesian OS (Native Iced)"
arch=('x86_64')
url="https://github.com/your-repo/project-cartesian"
license=('MIT')

# Runtime dependencies
depends=('glibc' 'gcc-libs' 'wayland' 'libxkbcommon' 'vulkan-icd-loader' 'polkit')

# We no longer need cargo as a makedepend inside makepkg because build.sh handles it
makedepends=()

source=("cartesian-admin.sh"
        "org.cartesian.policy"
        "50-cartesian.rules")
sha256sums=('SKIP'
            'SKIP'
            'SKIP')

# We skip the build() function entirely to avoid redundant compilation.
# build.sh performs the compilation before calling makepkg.

package() {
    # 1. Install Binary
    # We pull directly from the source directory where build.sh just placed the release binary
    install -Dm755 "$startdir/../src/cartesian-core/target/release/cartesian-core" "$pkgdir/usr/bin/cartesian-core"

    # 2. Install Sidecar Files (Admin Scripts)
    # These are sourced from the 'pkg' directory where the PKGBUILD lives
    install -Dm755 "$srcdir/cartesian-admin.sh" "$pkgdir/usr/bin/cartesian-admin"
    install -Dm644 "$srcdir/org.cartesian.policy" "$pkgdir/usr/share/polkit-1/actions/org.cartesian.policy"
    install -Dm644 "$srcdir/50-cartesian.rules" "$pkgdir/usr/share/polkit-1/rules.d/50-cartesian.rules"
}