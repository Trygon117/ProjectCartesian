# Maintainer: Cartesian Dev <your_email>
pkgname=cartesian-core
pkgver=0.1.0
pkgrel=1
pkgdesc="AI System Manager for Cartesian OS (Native Iced)"
arch=('x86_64')
url="https://github.com/your-repo/project-cartesian"
license=('MIT')
# Iced Dependencies: Wayland, Vulkan, XKB (Keyboard), Polkit
depends=('glibc' 'gcc-libs' 'wayland' 'libxkbcommon' 'vulkan-icd-loader' 'polkit')
makedepends=('cargo')

source=("cartesian-admin.sh"
        "org.cartesian.policy"
        "50-cartesian.rules")
sha256sums=('SKIP'
            'SKIP'
            'SKIP')

_project_root="cartesian-core"

prepare() {
    echo "Copying local source code..."
    # We assume src/cartesian-core is now the clean Iced project
    cp -r "$startdir/../src/cartesian-core" "$srcdir/"
}

build() {
    cd "$srcdir/$_project_root"
    # Pure Rust build. No npm, no tauri.
    cargo build --release
}

package() {
    # 1. Install Binary
    cd "$srcdir/$_project_root"
    install -Dm755 "target/release/cartesian-core" "$pkgdir/usr/bin/cartesian-core"

    # 2. Install Sidecar Files (Admin Scripts)
    cd "$srcdir"
    install -Dm755 "cartesian-admin.sh" "$pkgdir/usr/bin/cartesian-admin"
    install -Dm644 "org.cartesian.policy" "$pkgdir/usr/share/polkit-1/actions/org.cartesian.policy"
    install -Dm644 "50-cartesian.rules" "$pkgdir/usr/share/polkit-1/rules.d/50-cartesian.rules"
}
