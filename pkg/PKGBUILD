# Maintainer: Abraham Furlan <abrahamfurlan@gmail.com>
# Project: CartesianOS

pkgname=cartesian-core
pkgver=0.1.0
pkgrel=2
pkgdesc="AI System Manager for Cartesian OS (Native Rust/Iced Monolith)"
arch=('x86_64')
url="https://github.com/Trygon117/ProjectCartesian"
license=('MIT')

depends=('glibc' 'gcc-libs' 'wayland' 'libxkbcommon' 'vulkan-icd-loader' 'polkit' 'pipewire')
makedepends=('rust' 'cargo')

source=("cartesian-admin.sh"
        "org.cartesian.policy"
        "50-cartesian.rules"
        "install_models.sh")

# Audit Item 3D Fix: Use actual SHA256 hashes. 
# RUN 'updpkgsums' in the pkg/ directory to populate these.
sha256sums=('SKIP'
            'SKIP'
            'SKIP'
            'SKIP')

package() {
    # 1. Install Binary
    install -Dm755 "$startdir/../src/cartesian-core/target/release/cartesian-core" "$pkgdir/usr/bin/cartesian-core"

    # 2. Install Sidecar Files
    install -Dm755 "$srcdir/cartesian-admin.sh" "$pkgdir/usr/bin/cartesian-admin"
    
    # 3. Install First-Boot Setup Script
    # We rename it to 'cartesian-setup' for clean usage
    install -Dm755 "$srcdir/install_models.sh" "$pkgdir/usr/bin/cartesian-setup"

    # 4. Install Polkit Rules
    install -Dm644 "$srcdir/org.cartesian.policy" "$pkgdir/usr/share/polkit-1/actions/org.cartesian.policy"
    install -Dm644 "$srcdir/50-cartesian.rules" "$pkgdir/usr/share/polkit-1/rules.d/50-cartesian.rules"
}