# Maintainer: Abraham Furlan <abrahamfurlan@gmail.com>
# Project: CartesianOS

pkgname=cartesian-core
pkgver=0.1.0
pkgrel=4
pkgdesc="AI System Manager for Cartesian OS (Native Rust/Iced Monolith)"
arch=('x86_64')
url="https://github.com/Trygon117/ProjectCartesian"
license=('MIT')

depends=('glibc' 'gcc-libs' 'wayland' 'libxkbcommon' 'vulkan-icd-loader' 'polkit' 'pipewire' 'nvidia-utils')
makedepends=('rust' 'cargo')

source=("cartesian-admin.sh"
        "org.cartesian.policy"
        "50-cartesian.rules")

sha256sums=('SKIP'
            'SKIP'
            'SKIP')

package() {
    # 1. Install Binary
    # The build script mocks this path using the Ubuntu artifact
    install -Dm755 "$startdir/../src/cartesian-core/target/release/cartesian-core" "$pkgdir/usr/bin/cartesian-core"

    # 2. Install Bundled CUDA Libraries
    # The build script places artifacts here from Stage 1
    install -d "$pkgdir/usr/lib/cartesian"
    # Look in the libs folder next to the PKGBUILD
    install -m644 "$startdir/libs/"*.so* "$pkgdir/usr/lib/cartesian/"

    # 3. Install Wrapper Script
    install -Dm755 "$srcdir/cartesian-admin.sh" "$pkgdir/usr/bin/cartesian-admin"
    
    # 4. Polkit & Rules
    install -Dm644 "$srcdir/org.cartesian.policy" "$pkgdir/usr/share/polkit-1/actions/org.cartesian.policy"
    install -Dm644 "$srcdir/50-cartesian.rules" "$pkgdir/usr/share/polkit-1/rules.d/50-cartesian.rules"
}